{{merging|Minecraft Wiki:Projects/wiki.vg merge/Classic Protocol}}
{{Disclaimer}}
{{outdated|edition=je}}
Documentation on the server protocol used by the ''[[Minecraft]]'' [[Java Edition Classic|Classic Creative]] server.

==Minecraft.net communication==
===Heartbeats===
To be able to connect to a server in [[Java Edition Classic|Minecraft Classic]] from the [[server list]], a server must broadcast to [[minecraft.net]] a so-called "heartbeat" every few minutes.

The stock server broadcasts this heartbeat every 45 seconds.

A "heartbeat" takes the form of an HTTP request to https://minecraft.net/heartbeat.jsp.
After sending a heartbeat, the URL for the server is returned.

It is critical to a successful heartbeat that you leave out the "www" in the HTTP request, as you are going to be targeting it as a URI, not a URL.

It can be a GET or POST request. A table of the required parameters is below:
{| class="wikitable" data-description="Parameters"
!Name !!Details
|-
|port || Port number of the server. This is usually 25565
|-
|max || Maximum number of players on the server
|-
|name || The name of the server
|-
|public || Whether the server is public (i.e. appears in the server list) or not. Can be '''True''' or '''False''', in that capitalization.
|-
|version || [[Protocol version|Protocol version number]], this should be 7 unless you're using a client version older than 0.28.
|-
|salt || A random, 16-character base-62 salt
|-
|users || Number of users connected to the server
|}
The simplest way to send a heartbeat is to open a TCP socket to port 80 on minecraft.net, and send the following (with the values changed, obviously):

'''GET /heartbeat.jsp?port=25565&max=32&name=My%20Server&public=True&version=7&salt=wo6kVAHjxoJcInKx&users=0''', plus a CRLF(Carriage-return and Line feed).

Make sure any strings, like name, are escaped.

If everything goes well, in the response body you'll receive a URL to the server. Otherwise you'll get a nice HTML error message. There aren't any HTML headers to parse, as the HTTP version is not specified so HTTP/0.9 is used, which does not have headers.

===User authentication===
The "key" provided when a user joins the server can be compared to the MD5 checksum of the server's "salt" plus the username to verify that the user is logged in to minecraft.net with that username.  This is useful for establishing enough trust of the name provided to ban or op the player by name.

 if( player.key == md5( server.salt + player.name ) ) {
  // player is logged in via minecraft.net
 } else {
  // player is forging the username
 }

This is also the way that Notch prevents "cracked," or pirated, clients from accessing online servers. When a cracked client tries to connect to an online server, an error appears at the connection screen saying, "Failed to Connect: User Not Premium"

Note: This means that you should make sure your "salt" is kept a secret and shared only with heartbeat.jsp.  If your server's "salt" is visible anywhere to users, it is trivial for users to produce valid-looking "key"s without being logged in to minecraft.net.

==Packet protocol==

Every packet starts with a byte representing the Packet ID.

=== Protocol data types ===
{| class="wikitable" data-description="Protocol data types"
!Type !! Size [bytes] !! Description
|-
|Byte || 1 || Single byte integer (0 to 255)
|-
|SByte || 1 || Single byte signed integer (-128 to 127)
|-
|Short || 2 || Signed integer, [[wikipedia:Endianness#Endianness in networking|network order]] (-32768 to 32767)
|-
|String || 64 || US-ASCII/ISO646-US encoded string padded with spaces (0x20)
|-
|Byte array || 1024 || Binary data padded with null bytes (0x00)
|}

=== Client &rarr; server packets ===
{| class="wikitable" data-description="Client > server packets"
!width="64"| Packet ID
!width="160"| Purpose
!width="160"| Field Description
!width="72"| Field Type
! Notes
|-
|rowspan=5| 0x00
|rowspan=5| Player Identification
| Packet ID || Byte
|rowspan=5| Sent by a player joining a server with relevant information.  Current protocol version is 0x07.
|-
| Protocol version || Byte
|-
| Username || String
|-
| Verification key || String
|-
| Unused || Byte
|-
|rowspan=6| 0x05
|rowspan=6| Set Block
| Packet ID || Byte
|rowspan=6| Sent when a user changes a block.  The mode field indicates whether a block was created (0x01) or destroyed (0x00).
Block type is always the type player is holding, (even when deleting).

Client assumes that this command packet always succeeds, and so draws the new block immediately. To disallow block creation, server must send back Set Block packet with the old block type.

The XYZ coordinates of the block are just integers representing the coordinate of the block. (As opposed to player coordinates where the lower 5 bits are fractional coordinates)
|-
| X || Short
|-
| Y || Short
|-
| Z || Short
|-
| Mode || Byte
|-
| Block type || Byte
|-
|rowspan=7| 0x08
|rowspan=7| Position and Orientation
| Packet ID || Byte
|rowspan=7| Sent frequently (even while not moving) by the player with the player's current location and orientation. Player ID is always 255, referring to itself. Player coordinates are fixed-point values with the lowest 5 bits representing the fractional position (i.e. divide by 32 to get actual position in terms of block coordinates).  The angle parameters are scaled such that a value of 255 would correspond to 360 degrees.
|-
| Player ID || Byte
|-
| X || Short
|-
| Y || Short
|-
| Z || Short
|-
| Yaw (Heading) || Byte
|-
| Pitch || Byte
|-
|rowspan=3| 0x0d
|rowspan=3| Message
| Packet ID || Byte
|rowspan=3| Contain chat messages sent by player.
|-
| Unused, maybe message color || Byte (0xFF)
|-
| Message || String
|}

=== Server &rarr; client packets ===
{| class="wikitable" data-description="Server > client packets"
!width="64"| Packet ID
!width="160"| Purpose
!width="160"| Field Description
!width="72"| Field Type
! Notes
|-
|rowspan=5| 0x00
|rowspan=5| Server Identification
| Packet ID || Byte
|rowspan=5| Response to a joining player.  The user type indicates whether a player is an op (0x64) or not (0x00)  Current protocol version is 0x07.
|-
| Protocol version || Byte
|-
| Server name || String
|-
| Server MOTD || String
|-
| User type || Byte
|-
| 0x01
| Ping
| Packet ID || Byte
| Sent to clients periodically.  The only way a client can disconnect at the moment is to force it closed, which does not let the server know. The ping packet is used to determine if the connection is still open.
|-
| 0x02
| Level Initialize
| Packet ID || Byte
| Notifies player of incoming level data.
|-
|rowspan=4| 0x03
|rowspan=4| Level Data Chunk
| Packet ID || Byte
|rowspan=4| Contains a chunk of gzipped map (not level.dat file). After decompression the map consists of an int(4 bytes) containing number of blocks + raw map array. (chunk is up to 1024 bytes, padded with 0x00s if less).
|-
| Chunk Length || Short
|-
| Chunk Data || Byte Array
|-
| Percent Complete || Byte
|-
|rowspan=4| 0x04
|rowspan=4| Level Finalize
| Packet ID || Byte
|rowspan=4| Sent after level data is complete and gives map dimensions. The y coordinate is how tall the map is.
|-
| X Size || Short
|-
| Y Size || Short
|-
| Z Size || Short
|-
|rowspan=5| 0x06
|rowspan=5| Set Block
| Packet ID || Byte
|rowspan=5| Sent to indicate a block change by physics or by players.  In the case of a player change, the server also echos the block change back to the player who initiated it.
|-
| X || Short
|-
| Y || Short
|-
| Z || Short
|-
| Block Type || Byte
|-
|rowspan=8| 0x07
|rowspan=8| Spawn Player
| Packet ID || Byte
|rowspan=8| Sent to indicate where a new player is spawning in the world.  Position and orientation are encoded the same as for packet 0x08 below.
|-
| Player ID || SByte
|-
| Player Name || String
|-
| X || Short
|-
| Y || Short
|-
| Z || Short
|-
| Yaw (Heading) || Byte
|-
| Pitch || Byte
|-
|rowspan=7| 0x08
|rowspan=7| Position and Orientation (Player Teleport)
| Packet ID || Byte
|rowspan=7| Sent with changes in player position and rotation. Teleports player it's sent to if player ID < 0 (For sending initial position in map, and /tp)
|-
| Player ID || SByte
|-
| X || Short
|-
| Y || Short
|-
| Z || Short
|-
| Yaw (Heading) || Byte
|-
| Pitch || Byte
|-
|rowspan=7| 0x09
|rowspan=7| Position and Orientation Update
| Packet ID || Byte
|rowspan=7| Sent with changes in player position and rotation. Sent when both position and orientation is changed at the same time.
Not required for server operation.
|-
| Player ID || SByte
|-
| Change in X || SByte
|-
| Change in Y || SByte
|-
| Change in Z || SByte
|-
| Yaw (Heading) || Byte
|-
| Pitch || Byte
|-
|rowspan=5| 0x0a
|rowspan=5| Position Update
| Packet ID || Byte
|rowspan=5| Sent with changes in player position.
Not required for server operation.
|-
| Player ID || SByte
|-
| Change in X || SByte
|-
| Change in Y || SByte
|-
| Change in Z || SByte
|-
|rowspan=4| 0x0b
|rowspan=4| Orientation Update
| Packet ID || Byte
|rowspan=4| Sent with changes in player rotation.
Not required for server operation.
|-
| Player ID || SByte
|-
| Yaw (Heading) || Byte
|-
| Pitch || Byte
|-
|rowspan=2| 0x0c
|rowspan=2| Despawn Player
| Packet ID || Byte
|rowspan=2| Sent when player disconnects.
|-
| Player ID || SByte
|-
|rowspan=3| 0x0d
|rowspan=3| Message
| Packet ID || Byte
|rowspan=3| Messages sent by chat or from the console.
|-
| Player ID || SByte
|-
| Message || String
|-
|rowspan=2| 0x0e
|rowspan=2| Disconnect player
| Packet ID || Byte
|rowspan=2| Sent to a player when they're disconnected from the server.
#"Cheat detected: Distance" - happens not only when setting tile too far away from the player (how far is maximum distance and how it is measured?), but also when player moves and then immediately builds.
#"Cheat detected: Tile type"
|-
| Disconnect reason || String
|-
|rowspan=2| 0x0f
|rowspan=2| Update user type
| Packet ID || Byte
|rowspan=2| Sent when a player is opped/deopped
Grants or removes the client's ability of breaking Bedrock blocks
#User type can be either 100, which allows the player, or 0, which disallows the player to break Bedrock blocks
|-
| User type || Byte
|-
|}

==Player position==
===Fixed point===
Player position is represented via X, Y, and Z fixed-point coordinates.  The fractional portion is 5 bits, so dividing the short integers received in position update packets by 32 yields floating point coordinates for the player. This position corresponds to the center of the client viewport.
===Standing on things===
The bottom of the player's feet is located 1.59375 (fixed-point: 51) units below the center of the viewport, so to position the player on top of a particular block you could send a teleport (0x08) packet specifying a Y value based on the block position as: (Y x 32 + 51)
===Orientation===
A yaw value of 0 means the player is facing in the Z- (negative Z) direction.  This value increases in a clockwise direction as seen from above.  If we call the negative Z direction "North", then a yaw of 64 means "East", 128 means "South", and 192 means "West".

A pitch value of 0 means level and this value increases in a downward direction.  64 is down, and 192 is up.  Values of 65 to 191 should never occur because the player cannot look further up or down than the 64 → 0, 255 → 192 range. However, the Minecraft Classic client does not ignore invalid values, so it is possible to make players' heads "upside-down".

==Color codes==
{{about|classic server protocol|the updated color codes used in the current version of Minecraft|Formatting codes}}

Messages sent from the server to the client can contain color codes, which allow coloring of text for various purposes.

An ampersand symbol (&) followed by a hex digit in the message tells the client to switch colors while displaying text. The current version of the game uses a section (§) symbol, but the 0.30 version uses ampersands. For the formatting codes for the current version of the game, see [[Formatting codes]].

Color coding at the start of the message works only if the player ID byte is less than 127. If it's 127 or higher, the game automatically adds &e before the message, making it yellow. However, color codes after the first character still work. If using an ID below 127, it doesn't add a color code, so the values used still work.

[[File:ClassicColors.png|thumb|Hex digit to color mapping.]]

{| class="wikitable" style="text-align:center;" border="1" cellpadding="5" data-description="Text colors"
|-
! colspan="1"  width="8px"| Sample
! colspan="1" | Code
! colspan="1" | Common Name
! colspan="1" | Alternate Name
! colspan="4" | Foreground Color
! colspan="4" | Background Color
|-
| || || ||
|width="30px"|R
|width="30px"|G
|width="30px"|B
|width="40px"|HEX
|width="30px"|R
|width="30px"|G
|width="30px"|B
|width="40px"|HEX
|-
| bgcolor="black" |
<!-- This page is about Minecraft Classic, which used Ampersands, both the client and the server - look at any open source Server software to see for yourself. -->
| &0 || Black || Black || 0 || 0 || 0 || #000 || 0 || 0 || 0 || #000000
|-
| bgcolor=#0000AA |
| &1 || Dark Blue || Navy || 0 || 0 || 170 || #00A || 0 || 0 || 42 || #00002A
|-
| bgcolor=#00AA00 |
| &2 || Dark Green || Green || 0 || 170 || 0 || #0A0 || 0 || 42 || 0 || #002A00
|-
| bgcolor=#00AAAA |
| &3 || Teal || Teal || 0  || 170 || 170 || #0AA || 0 || 42 || 42 || #002A2A
|-
| bgcolor=#AA0000 |
| &4 || Dark Red || Maroon || 170 || 0 || 0 || #A00 || 42 || 0 || 0 || #2A0000
|-
| bgcolor=#AA00AA |
| &5 || Purple || Purple || 170 || 0 || 170 || #A0A || 42 || 0 || 42 || #2A002A
|-
| bgcolor=#AAAA00 |
| &6 || Dark Yellow || Gold || 170 || 170 || 0 || #AA0 || 42 || 42 || 0 || #2A2A00
|-
| bgcolor=#AAAAAA |
| &7 || Gray || Silver || 170 || 170 || 170 || #AAA || 42 || 42 || 42 || #2A2A2A
|-
| bgcolor=#55555 |
| &8 || Dark Gray || Gray || 85 || 85 || 85 || #555 || 21 || 21 || 21 || #151515
|-
| bgcolor=#5555FF |
| &9 || Indigo || Blue || 85 || 85 || 255 || #55F || 21 || 21 || 63 || #15153F
|-
| bgcolor=#55FF55 |
| &a || Bright Green || Lime || 85 || 255 || 85 || #5F5 || 21 || 63 || 21 || #153F15
|-
| bgcolor=#55FFFF |
| &b || Cyan || Aqua || 85 || 255 || 255 || #5FF || 21 || 63 || 63 || #153F3F
|-
| bgcolor=#FF5555 |
| &c || Red || Red || 255 || 85 || 85 || #F55 || 63 || 21 || 21 || #3F1515
|-
| bgcolor=#FF55FF |
| &d || Pink || Pink || 255 || 85 || 255 || #F5F || 63 || 21 || 63 || #3F153F
|-
| bgcolor=#FFFF55 |
| &e || Yellow || Yellow || 255 || 255 || 85 || #FF5 || 63 || 63 || 21 || #3F3F15
|-
| bgcolor=#FFFFFF |
| &f || White || White || 255 || 255 || 255 || #FFF || 63 || 63 || 63 || #3F3F3F
|-
|}

== Navigation ==
{{Navbox Java Edition technical|general}}

[[Category:Development]]

[[de:Classic-Server Protokoll]]
[[fr:Protocole de serveur Classique]]
[[nl:Classic server protocol]]
[[pt:Protocolo de servidor Classic]]
[[ru:Протокол сервера Classic]]
[[zh:Classic服务器协议]]